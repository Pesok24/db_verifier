# db_verifier

Скрипт для проверки структуры БД на наличие ошибок или нерекомендуемых практик.

Скрипт состоит из набора проверок, которые обращаются к таблицам системного каталога и не требуют обращения к данным в 
пользовательских таблицах.

Актуальная версия применима к PostgreSQL 15 и новее. Протестировано в версии PostgreSQL 15.5.

(используется `pg_catalog.pg_index.indnullsnotdistinct`, см.`UNIQUE NULLS NOT DISTINCT` https://postgrespro.ru/docs/postgresql/15/release-15)

## Структура проекта

* [`db_verifier.sql`](db_verifier.sql) - скрипт, проверяет и выводит список ошибок/предупреждений/рекомендаций с комментариями
* `tests` - каталог с DDL/DML скриптами, которые используются для отладки db_verifier и демонстрации ошибок

## Перечень проверок

 code     | parent_code    | name                      | level     | default state | description
:---------|:---------------|:--------------------------|:----------|:--------------|:-------------
no1001    |                | no unique key             | error     | enable        | У отношения нет уникального ключа (набора полей). Это может создавать проблемы при удалении записей, при логической репликации и др.
no1002    | no1001         | no primary key constraint | error     | enable        | У отношения нет ограничения primary key.                    
fk1001    |                | fk uses mismatched types  | error     | enable        | Внешний ключ использует колонки с несовпадающими типами.    
fk1002    |                | fk uses nullable columns  | warning   | disable       | Внешний ключ использует колонки, допускающие значение NULL. 


## Другие описания проекта

* \[EN] [`README.md`](README.md)